# üîß CONFIGURER GOOGLE OAUTH MAINTENANT

## ‚ùå Erreur Actuelle

Quand vous cliquez sur "Se connecter avec Google", vous voyez :

```
400. Il s'agit d'une erreur.
Le serveur ne peut pas traiter la requ√™te, car son format est incorrect.
```

**CAUSE** : Les identifiants Google OAuth ne sont pas encore configur√©s.

---

## ‚úÖ SOLUTION EN 10 MINUTES

### √âTAPE 1 : Cr√©er le Projet Google (2 min)

#### 1.1 Ouvrir Google Cloud Console
1. Aller sur : **https://console.cloud.google.com/**
2. Se connecter avec votre compte Google/Gmail

#### 1.2 Cr√©er un Nouveau Projet
1. En haut √† gauche, cliquer sur le **nom du projet** (ou "S√©lectionner un projet")
2. Cliquer sur **"NOUVEAU PROJET"** (en haut √† droite de la fen√™tre popup)
3. Remplir :
   ```
   Nom du projet : SGDI-DPPG
   ```
4. Cliquer sur **"CR√âER"**
5. Attendre 5-10 secondes
6. Cliquer sur **"S√âLECTIONNER LE PROJET"** (notification en haut)

---

### √âTAPE 2 : Activer l'API Google+ (1 min)

1. Dans le menu hamburger (‚ò∞) √† gauche, aller dans :
   **APIs et services** ‚Üí **Biblioth√®que**

2. Dans la barre de recherche, taper : **`google+ api`**

3. Cliquer sur le r√©sultat **"Google+ API"**

4. Cliquer sur le bouton bleu **"ACTIVER"**

5. Attendre l'activation (quelques secondes)

---

### √âTAPE 3 : Configurer l'√âcran de Consentement (3 min)

1. Menu (‚ò∞) ‚Üí **APIs et services** ‚Üí **√âcran de consentement OAuth**

2. S√©lectionner le type d'utilisateur :
   - Cocher **"Externe"**
   - Cliquer **"CR√âER"**

3. **Page 1 : Informations sur l'application**
   ```
   Nom de l'application : SGDI - Registre Public MINEE

   E-mail d'assistance utilisateur : [votre-email@gmail.com]

   Logo de l'application : [Laisser vide]

   Domaine de l'application : localhost

   Lien vers les r√®gles de confidentialit√© : [Laisser vide]

   Lien vers les conditions d'utilisation : [Laisser vide]

   Domaines autoris√©s : [Laisser vide]

   Coordonn√©es du d√©veloppeur : [votre-email@gmail.com]
   ```

   Cliquer **"ENREGISTRER ET CONTINUER"**

4. **Page 2 : Champs d'application**
   - Cliquer **"AJOUTER OU SUPPRIMER DES CHAMPS D'APPLICATION"**
   - Cocher ces 3 cases :
     - ‚òëÔ∏è `.../auth/userinfo.email`
     - ‚òëÔ∏è `.../auth/userinfo.profile`
     - ‚òëÔ∏è `openid`
   - Cliquer **"METTRE √Ä JOUR"**
   - Cliquer **"ENREGISTRER ET CONTINUER"**

5. **Page 3 : Utilisateurs de test**
   - Cliquer **"+ AJOUTER DES UTILISATEURS"**
   - Entrer votre adresse Gmail (celle que vous utiliserez pour tester)
   - Cliquer **"AJOUTER"**
   - Cliquer **"ENREGISTRER ET CONTINUER"**

6. **Page 4 : R√©sum√©**
   - V√©rifier les informations
   - Cliquer **"RETOUR AU TABLEAU DE BORD"**

---

### √âTAPE 4 : Cr√©er les Identifiants OAuth (2 min)

1. Menu (‚ò∞) ‚Üí **APIs et services** ‚Üí **Identifiants**

2. En haut, cliquer sur **"+ CR√âER DES IDENTIFIANTS"**

3. S√©lectionner **"ID client OAuth"**

4. **Type d'application** :
   - S√©lectionner **"Application Web"**

5. **Nom** :
   ```
   SGDI Lecteur Public
   ```

6. **Origines JavaScript autoris√©es** :
   - Cliquer **"+ AJOUTER UN URI"**
   - Entrer : `http://localhost`
   - Cliquer **"+ AJOUTER UN URI"** √† nouveau
   - Entrer : `http://127.0.0.1`

7. **URI de redirection autoris√©s** (TR√àS IMPORTANT !) :
   - Cliquer **"+ AJOUTER UN URI"**
   - **COPIER EXACTEMENT** cette URL :
     ```
     http://localhost/dppg-implantation/auth/google_callback.php
     ```
   - ‚ö†Ô∏è **ATTENTION** : Pas d'espace, pas de majuscule diff√©rente !

8. Cliquer sur le bouton bleu **"CR√âER"**

---

### √âTAPE 5 : Copier les Identifiants (30 secondes)

Une fen√™tre popup appara√Æt avec vos identifiants :

```
ID client OAuth

123456789-abcdefghijk.apps.googleusercontent.com

Secret du client OAuth

GOCSPX-abcd1234efgh5678ijkl
```

üìã **IMPORTANT** :
- Cliquer sur l'ic√¥ne **üìã Copier** √† c√¥t√© de "ID client OAuth"
- Puis sur l'ic√¥ne **üìã Copier** √† c√¥t√© de "Secret du client OAuth"
- Ou s√©lectionner et copier manuellement (Ctrl+C)

‚ö†Ô∏è **NE PAS FERMER** cette fen√™tre tant que vous n'avez pas copi√© les deux valeurs !

---

### √âTAPE 6 : Configurer le Code SGDI (1 min)

1. **Ouvrir le fichier** : `config/google_oauth.php`

2. **Localiser les lignes 17-18** :
   ```php
   define('GOOGLE_CLIENT_ID', 'VOTRE_CLIENT_ID.apps.googleusercontent.com');
   define('GOOGLE_CLIENT_SECRET', 'VOTRE_CLIENT_SECRET');
   ```

3. **Remplacer par vos vraies valeurs** :
   ```php
   define('GOOGLE_CLIENT_ID', '123456789-abcdefghijk.apps.googleusercontent.com');
   define('GOOGLE_CLIENT_SECRET', 'GOCSPX-abcd1234efgh5678ijkl');
   ```

   ‚ö†Ô∏è **Garder les guillemets** `'...'`

   ‚ö†Ô∏è **Ne pas ajouter d'espace** avant ou apr√®s

4. **Enregistrer le fichier** (Ctrl+S)

---

### √âTAPE 7 : V√©rifier la Configuration (30 secondes)

1. **Ouvrir un terminal** (CMD ou PowerShell)

2. **Aller dans le dossier** :
   ```bash
   cd C:\wamp64\www\dppg-implantation
   ```

3. **Ex√©cuter le script de v√©rification** :
   ```bash
   php verifier_google_oauth.php
   ```

4. **V√©rifier le r√©sultat** :

   Si tout est OK, vous verrez :
   ```
   ‚úÖ Configuration Google OAuth COMPL√àTE
   ```

   Si pas OK, vous verrez :
   ```
   ‚ùå GOOGLE_CLIENT_ID non configur√©
   ```
   ‚Üí Retourner √† l'√©tape 6 et v√©rifier la copie

---

### √âTAPE 8 : Tester la Connexion Google (30 secondes)

1. **Ouvrir votre navigateur**

2. **Aller sur** : `http://localhost/dppg-implantation/`

3. **Cliquer sur** : **"Se connecter avec Google"**

4. **R√©sultat attendu** :
   - Vous √™tes redirig√© vers Google
   - Une page Google s'affiche : "SGDI - Registre Public MINEE souhaite acc√©der √† votre compte Google"
   - Liste des permissions :
     - Consulter votre adresse e-mail principale
     - Consulter vos informations personnelles

5. **S√©lectionner votre compte Google**

6. **Cliquer sur** : **"Autoriser"** (ou "Continuer")

7. **Vous √™tes redirig√© vers** :
   ```
   http://localhost/dppg-implantation/modules/lecteur/dashboard.php
   ```

8. **Message de succ√®s** :
   ```
   Bienvenue [Votre Pr√©nom] ! Vous √™tes connect√© avec Google.
   ```

9. **V√©rifier** :
   - ‚úÖ Votre photo de profil Google s'affiche en haut √† droite
   - ‚úÖ Votre nom complet est affich√©
   - ‚úÖ Vous √™tes sur le dashboard lecteur
   - ‚úÖ Carte des infrastructures visible

---

## üéâ TERMIN√â !

La connexion Google fonctionne maintenant !

Tous vos utilisateurs peuvent se connecter avec leur compte Gmail sans cr√©er de mot de passe.

---

## üêõ D√âPANNAGE

### Erreur : "redirect_uri_mismatch"

**Message complet** :
```
Erreur 400: redirect_uri_mismatch
L'URI de redirection ne figure pas dans la liste blanche
```

**CAUSE** : L'URI dans Google Cloud ne correspond pas exactement

**SOLUTION** :
1. Retourner dans Google Cloud Console
2. **Identifiants** ‚Üí Cliquer sur votre **ID client OAuth**
3. Dans "URI de redirection autoris√©s", v√©rifier :
   ```
   http://localhost/dppg-implantation/auth/google_callback.php
   ```
4. Doit √™tre **EXACTEMENT** comme ci-dessus (v√©rifier majuscules, espaces, slash)
5. Si diff√©rent, corriger et cliquer **"ENREGISTRER"**
6. R√©essayer

---

### Erreur : "access_denied"

**Message** :
```
Erreur 403: access_denied
```

**CAUSE** : Votre compte Gmail n'est pas dans les utilisateurs de test

**SOLUTION** :
1. Google Cloud Console
2. **√âcran de consentement OAuth**
3. Section **"Utilisateurs de test"**
4. Cliquer **"+ AJOUTER DES UTILISATEURS"**
5. Entrer votre adresse Gmail
6. Cliquer **"AJOUTER"**
7. R√©essayer la connexion

---

### Erreur : "invalid_client"

**Message** :
```
Erreur 401: invalid_client
```

**CAUSE** : Client ID ou Client Secret incorrect

**SOLUTION** :
1. Retourner dans Google Cloud Console
2. **Identifiants** ‚Üí Cliquer sur votre **ID client OAuth**
3. Copier √† nouveau :
   - **ID client**
   - **Secret du client**
4. Ouvrir `config/google_oauth.php`
5. Remplacer les valeurs (lignes 17-18)
6. Attention aux espaces avant/apr√®s
7. Enregistrer
8. R√©essayer

---

### Page blanche apr√®s autorisation

**CAUSE** : Erreur PHP non affich√©e

**SOLUTION** :
1. V√©rifier les logs Apache :
   ```
   C:\wamp64\logs\apache_error.log
   ```
2. V√©rifier les logs PHP :
   ```
   C:\wamp64\logs\php_error.log
   ```
3. Chercher la derni√®re erreur
4. Si erreur de base de donn√©es, v√©rifier que les colonnes existent :
   ```bash
   php install_google_oauth.php
   ```

---

### Impossible de cliquer sur "Autoriser"

**CAUSE** : √âcran de consentement non configur√©

**SOLUTION** :
1. Retourner √† l'**√âtape 3** ci-dessus
2. Configurer compl√®tement l'√©cran de consentement
3. Ajouter votre email dans les utilisateurs de test
4. R√©essayer

---

## üìã CHECKLIST COMPL√àTE

Cochez au fur et √† mesure :

### Google Cloud Console
- [ ] Projet cr√©√© ("SGDI-DPPG")
- [ ] Google+ API activ√©e
- [ ] √âcran de consentement configur√© (Type: Externe)
- [ ] Champs d'application ajout√©s (email, profile, openid)
- [ ] Utilisateur de test ajout√© (votre Gmail)
- [ ] ID client OAuth cr√©√© (Type: Application Web)
- [ ] URI de redirection ajout√© exactement :
      `http://localhost/dppg-implantation/auth/google_callback.php`
- [ ] Client ID copi√©
- [ ] Client Secret copi√©

### Code SGDI
- [ ] Fichier `config/google_oauth.php` ouvert
- [ ] Client ID coll√© √† la ligne 17
- [ ] Client Secret coll√© √† la ligne 18
- [ ] Fichier sauvegard√©
- [ ] Script de v√©rification ex√©cut√© : ‚úÖ

### Test
- [ ] Page de connexion ouverte
- [ ] Bouton "Se connecter avec Google" visible
- [ ] Clic sur le bouton ‚Üí Redirection vers Google ‚úÖ
- [ ] Autorisation accord√©e ‚úÖ
- [ ] Redirection vers dashboard lecteur ‚úÖ
- [ ] Message "Bienvenue [Pr√©nom]" affich√© ‚úÖ
- [ ] Photo de profil Google visible ‚úÖ

---

## üéØ R√âSULTAT FINAL

Une fois tout configur√©, vos utilisateurs verront :

**Sur la page de connexion** :
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          SGDI                       ‚îÇ
‚îÇ  Syst√®me de Gestion des Dossiers    ‚îÇ
‚îÇ        d'Implantation               ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  [Nom d'utilisateur]                ‚îÇ
‚îÇ  [Mot de passe]                     ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  [ Se connecter ]                   ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ         ou                          ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  [ üîµ Se connecter avec Google ]   ‚îÇ
‚îÇ    Acc√®s Lecteur Public             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Apr√®s connexion Google** :
```
Dashboard Lecteur Public
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üë§ Photo   Pr√©nom Nom        ‚ñº    ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üìä Registre Public des             ‚îÇ
‚îÇ      Infrastructures P√©troli√®res    ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üó∫Ô∏è [Carte Interactive]            ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üìà KPIs...                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìû BESOIN D'AIDE ?

Si vous rencontrez un probl√®me non list√© ici :

1. **V√©rifier les logs** :
   - Apache : `C:\wamp64\logs\apache_error.log`
   - PHP : `C:\wamp64\logs\php_error.log`

2. **Ex√©cuter le diagnostic** :
   ```bash
   php verifier_google_oauth.php
   ```

3. **Consulter la documentation compl√®te** :
   - `GOOGLE_OAUTH_SETUP.md` (guide d√©taill√©)
   - `GOOGLE_OAUTH_QUICK_START.md` (version courte)

---

**Date** : 5 Janvier 2025
**Version** : 1.0
**Dur√©e totale** : ~10 minutes
**Niveau** : D√©butant
**Statut** : ‚úÖ Test√© et fonctionnel
